<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJ CHAUFFAGE - API Architecture Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        .diagram-section {
            margin-bottom: 50px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 15px;
            border: 1px solid #e2e8f0;
        }
        h2 {
            color: #4a5568;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .icon {
            font-size: 1.5em;
        }
        .mermaid {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
            background: #edf2f7;
            border-radius: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #cbd5e0;
            transition: transform 0.3s;
        }
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .info-card h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .info-card p {
            color: #718096;
            line-height: 1.6;
        }
        .endpoint-list {
            list-style: none;
            padding: 0;
        }
        .endpoint-list li {
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .method {
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.85em;
        }
        .method.get { background: #48bb78; color: white; }
        .method.post { background: #4299e1; color: white; }
        .method.put { background: #ed8936; color: white; }
        .method.delete { background: #f56565; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• MJ CHAUFFAGE - Architecture API</h1>
        <div class="subtitle">Syst√®me de Gestion E-commerce - Sch√©ma Technique</div>

        <!-- System Overview -->
        <div class="diagram-section">
            <h2><span class="icon">üèóÔ∏è</span> Vue d'ensemble du syst√®me</h2>
            <div class="mermaid">
graph TB
    subgraph "Frontend - Next.js [:3000]"
        CLIENT[Application Client]
        ADMIN[Dashboard Admin]
        SERVICES[Services API]
    end
    
    subgraph "Backend - Express [:3001]"
        GATEWAY[API Gateway]
        AUTH[Middleware Auth]
        CONTROLLERS[Contr√¥leurs]
        BUSINESS[Services M√©tier]
        DATABASE[(Base SQLite)]
    end
    
    CLIENT --> SERVICES
    ADMIN --> SERVICES
    SERVICES --> GATEWAY
    GATEWAY --> AUTH
    AUTH --> CONTROLLERS
    CONTROLLERS --> BUSINESS
    BUSINESS --> DATABASE

    style CLIENT fill:#e6f3ff,stroke:#333,stroke-width:2px
    style ADMIN fill:#fff3e6,stroke:#333,stroke-width:2px
    style DATABASE fill:#f0f0f0,stroke:#333,stroke-width:2px
            </div>
        </div>

        <!-- Product Flow -->
        <div class="diagram-section">
            <h2><span class="icon">üõí</span> Flux de gestion des produits</h2>
            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant F as Frontend
    participant PS as ProductService
    participant B as Backend API
    participant DB as Database

    rect rgb(200, 230, 255)
        Note over U,DB: Navigation Produits
        U->>F: Consulter produits
        F->>PS: getProducts()
        PS->>B: GET /api/v1/products
        B->>DB: SELECT * FROM products
        DB-->>B: Donn√©es produits + images
        B-->>PS: Response JSON
        PS-->>F: Liste format√©e
        F-->>U: Affichage avec images
    end

    rect rgb(255, 230, 200)
        Note over U,DB: D√©tail Produit
        U->>F: Clic sur produit
        F->>PS: getProduct(id)
        PS->>B: GET /api/v1/products/{id}
        B->>DB: SELECT avec relations
        DB-->>B: Produit complet
        B-->>PS: D√©tails produit
        PS-->>F: Donn√©es format√©es
        F-->>U: Page produit
    end
            </div>
        </div>

        <!-- Admin Product Creation -->
        <div class="diagram-section">
            <h2><span class="icon">‚öôÔ∏è</span> Cr√©ation de produit (Admin)</h2>
            <div class="mermaid">
flowchart LR
    A[Admin] --> B[Formulaire]
    B --> C{Validation}
    C -->|Valide| D[Upload Images]
    D --> E[Conversion Base64]
    E --> F[API Call]
    F --> G[Backend]
    G --> H[Insertion DB]
    H --> I[Table products]
    H --> J[Table product_images]
    C -->|Invalide| K[Erreur]

    style A fill:#ffd700,stroke:#333,stroke-width:2px
    style I fill:#90EE90,stroke:#333,stroke-width:2px
    style J fill:#90EE90,stroke:#333,stroke-width:2px
    style K fill:#ffcccc,stroke:#333,stroke-width:2px
            </div>
        </div>

        <!-- Cart & Checkout Flow -->
        <div class="diagram-section">
            <h2><span class="icon">üõçÔ∏è</span> Flux Panier et Commande</h2>
            <div class="mermaid">
stateDiagram-v2
    [*] --> Navigation
    Navigation --> ProduitDetail: S√©lection
    ProduitDetail --> Panier: Ajouter
    Panier --> Checkout: Valider
    Checkout --> Paiement: Confirmer
    Paiement --> Commande: Succ√®s
    Commande --> [*]
    
    Panier --> Navigation: Continuer
    Checkout --> Panier: Modifier
    Paiement --> Checkout: √âchec
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="diagram-section">
            <h2><span class="icon">üìç</span> Points d'acc√®s API principaux</h2>
            
            <div class="info-grid">
                <div class="info-card">
                    <h3>üõí Produits</h3>
                    <ul class="endpoint-list">
                        <li>
                            <span>/api/v1/products</span>
                            <span class="method get">GET</span>
                        </li>
                        <li>
                            <span>/api/v1/products/:id</span>
                            <span class="method get">GET</span>
                        </li>
                        <li>
                            <span>/api/v1/products</span>
                            <span class="method post">POST</span>
                        </li>
                        <li>
                            <span>/api/v1/products/:id</span>
                            <span class="method put">PUT</span>
                        </li>
                        <li>
                            <span>/api/v1/products/:id</span>
                            <span class="method delete">DELETE</span>
                        </li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üõçÔ∏è Panier</h3>
                    <ul class="endpoint-list">
                        <li>
                            <span>/api/v1/cart</span>
                            <span class="method get">GET</span>
                        </li>
                        <li>
                            <span>/api/v1/cart/items</span>
                            <span class="method post">POST</span>
                        </li>
                        <li>
                            <span>/api/v1/cart/items/:id</span>
                            <span class="method put">PUT</span>
                        </li>
                        <li>
                            <span>/api/v1/cart/clear</span>
                            <span class="method delete">DELETE</span>
                        </li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üì¶ Commandes</h3>
                    <ul class="endpoint-list">
                        <li>
                            <span>/api/v1/orders</span>
                            <span class="method get">GET</span>
                        </li>
                        <li>
                            <span>/api/v1/orders/:id</span>
                            <span class="method get">GET</span>
                        </li>
                        <li>
                            <span>/api/v1/orders</span>
                            <span class="method post">POST</span>
                        </li>
                        <li>
                            <span>/api/v1/orders/:id/status</span>
                            <span class="method put">PUT</span>
                        </li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üîê Authentification</h3>
                    <ul class="endpoint-list">
                        <li>
                            <span>/api/v1/auth/login</span>
                            <span class="method post">POST</span>
                        </li>
                        <li>
                            <span>/api/v1/auth/register</span>
                            <span class="method post">POST</span>
                        </li>
                        <li>
                            <span>/api/v1/auth/profile</span>
                            <span class="method get">GET</span>
                        </li>
                        <li>
                            <span>/api/v1/admin/login</span>
                            <span class="method post">POST</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Data Flow Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #48bb78;"></div>
                <span>GET - Lecture de donn√©es</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4299e1;"></div>
                <span>POST - Cr√©ation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ed8936;"></div>
                <span>PUT - Modification</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f56565;"></div>
                <span>DELETE - Suppression</span>
            </div>
        </div>

        <!-- Issues Fixed -->
        <div class="diagram-section" style="background: #f0fff4; border-color: #48bb78;">
            <h2><span class="icon">‚úÖ</span> Probl√®mes R√©solus</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>üîó Routing Produits</h3>
                    <p>
                        <strong>Probl√®me:</strong> Route /products/details/:id inexistante<br>
                        <strong>Solution:</strong> Utilisation de /products/:id directement
                    </p>
                </div>
                <div class="info-card">
                    <h3>üñºÔ∏è Images Produits</h3>
                    <p>
                        <strong>Probl√®me:</strong> Images non affich√©es<br>
                        <strong>Solution:</strong> Sauvegarde dans table product_images avec relations
                    </p>
                </div>
                <div class="info-card">
                    <h3>üìù Formatage Texte</h3>
                    <p>
                        <strong>Probl√®me:</strong> Caract√®res sp√©ciaux mal encod√©s<br>
                        <strong>Solution:</strong> UTF-8 partout + headers corrects
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#7c3aed',
                lineColor: '#5a67d8',
                secondaryColor: '#fbbf24',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#e6f3ff',
                secondBkg: '#fff3e6'
            }
        });
    </script>
</body>
</html>